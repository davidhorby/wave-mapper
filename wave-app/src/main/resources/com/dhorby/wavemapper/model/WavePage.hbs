<html title="Wave Mapper">
<head>
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    <script type="text/javascript">

        google.charts.load('current', {'packages':['corechart']});
        google.charts.load("current", {
            "packages":['map','geochart', 'table'],
            // Note: you will need to get a mapsApiKey for your project.
            // See: https://developers.google.com/chart/interactive/docs/basic_load_libs#load-settings
            "mapsApiKey": "{{mapsApiKey}}",
            "callback": drawMap
        });
        // google.charts.setOnLoadCallback(drawMap);

        function drawChart() {

            var data = google.visualization.arrayToDataTable([{{{waveData}}}]);

            //Graph styling and legend
            var options = {
                title: 'sumVar2 (%)',
                curveType: 'function',
                legend: { position: 'bottom' },
                vAxis: { title: 'someVar2 %'},
                hAxis: { title: 'someVar1'}
            };
            var chart = new google.visualization.LineChart(document.getElementById('chart_div'));

            chart.draw(data, options);
        }

        function drawMap() {
            var data = google.visualization.arrayToDataTable([{{{waveData}}}])

            var waveurl = 'https://icons.iconarchive.com/icons/iconsmind/outline/'

            var sharkicon ="https://icons.iconarchive.com/icons/martin-berube/animal/32/shark-icon.png"

            var sailboaticon = "https://icons.iconarchive.com/icons/aha-soft/transport/32/sailing-ship-icon.png"

            var pirateshipico = "https://icons.iconarchive.com/icons/pixelpress/pirates/48/Pirate-Ship-icon.png"

            var notavailable = "https://icons.iconarchive.com/icons/webiconset/blogging/16/Not-Available-for-Work-icon.png"

            var waveicon = 'Wave-icon.png'

            var skarkicon= 'shark-icon.png'

            var options = {
                zoomLevel: 6,
                showTooltip: true,
                showInfoWindow: true,
                useMapTypeControl: true,
                showLine: true,
                icons: {
                    verybig: {
                        normal:   waveurl + '/72/' + waveicon,
                        selected: waveurl + '/72/' + waveicon
                    },
                    big: {
                        normal:   waveurl + '/64/' + waveicon,
                        selected: waveurl + '/64/' + waveicon
                    },
                    medium: {
                        normal:   waveurl + '/48/' + waveicon,
                        selected: waveurl + '/48/' + waveicon
                    },
                    small: {
                        normal:   waveurl + '/32/' + waveicon,
                        selected: waveurl + '/32/' + waveicon
                    },
                    verysmall: {
                        normal:   waveurl + '/24/' + waveicon,
                        selected: waveurl + '/24/' + waveicon,
                    },
                    shark: {
                        normal:   sharkicon,
                        selected: sharkicon,
                    },
                    boat: {
                        normal:   sailboaticon,
                        selected: sailboaticon,
                    },
                    pirate: {
                        normal:   pirateshipico,
                        selected: pirateshipico,
                    },
                    notavailable: {
                        normal:   notavailable,
                        selected: notavailable,
                    }
                }
            };


            var map = new google.visualization.Map(document.getElementById('map_div'));
            map.draw(data, options);

            // google.visualization.events.addListener(map, 'select', selectHandler)

            function selectHandler(e) {
                var selection = map.getSelection()
                var message = '';
                var dataTable = data;
                for (var i = 0; i < selection.length; i++) {
                    var item = selection[i];
                    if (item.row != null) {
                        var lon = data.getFormattedValue(item.row, 0); // 0,1,2,3
                        var lat = data.getFormattedValue(item.row, 1); // 0,1,2,3
                        message += '{lat:' + lat + ',lon:' + lon + '}';
                        // message += '{lat:' + item.row + ', column:none}; value (col 0) = ' + str + '\n';
                    }
                }
                if (message == '') {
                    message = 'nothing';
                }
                fetch('/api/location?lat=' + lat + '&lon=' + lon)
                        .then(response=>response.text())
                        .then(data=> processLocation(data));

            }

            function processLocation(data) {
                alert('You selected ' + data)
            }

            var table =
                    new google.visualization.Table(document.getElementById('table_div'));
            table.draw(data, {showRowNumber: false, width: '100%', height: '100%'});

            google.visualization.events.addListener(map, 'select',
                    function() {
                        table.setSelection(map.getSelection());
                    });

        }


    </script>

</head>

<body>
<table align="center" width="100%" height="100%">
    <tr valign="top">
        <td style="width: 50%;">
            <div id="map_div" style="width: 100%; height: 100%;"></div>
        </td>
        <td style="width: 50%;">
            <table align="center" width="100%" height="100%">
                <tr valign="top">
                    <td style="width: 100%;height: 50%">
                        <div id="table_div"></div>
                    </td>
                </tr>
                <tr valign="top">
                    <td style="width: 100%;height: 50%">
                        <div id="action_form" style="align: left; vertical-align: top; width: 100%; height: 50%;">
                            <form action="/" method="POST" class="form-example">
                                <div class="form-example">
                                    <table>
                                        <tr>
                                            <td>Name</td>
                                            <td><input type="test" name="name" id="name_ip" required></td>
                                        </tr>
                                        <tr>
                                            <td>Type</td>
                                            <td>
                                                <select id="pieceType" name="pieceType">
                                                    <option value="BOAT">Boat</option>
                                                    <option value="SHARK">Shark</option>
                                                    <option value="PIRATE">Pirate</option>
                                                </select>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td>Lat</td>
                                            <td><input type="text" name="lat" id="lat_ip" required></td>
                                        </tr>
                                        <tr>
                                            <td>Lon</td>
                                            <td><input type="text" name="lon" id="long_ip" required></td>
                                        </tr>
                                    </table>
                                </div>
                                <div class="form-example">
                                    <input type="submit" value="Submit">
                                </div>
                            </form>
                        </div>
                    </td>
                    <td style="width: 100%;height: 50%">
                        <table>
                            <tr>
                                <td>Admin</td>
                            </tr>
                            <tr>
                                <td>
                                    <div id="clear_form" style="align: left; vertical-align: top; width: 100%; height: 50%;">
                                        <form action="/clear" method="GET" class="form-clear">
                                            <div class="form-clear">
                                                <input type="submit" value="Clear">
                                            </div>
                                        </form>
                                    </div>
                                </td>
                            </tr>
                        </table>
                    </td>
                </tr>
            </table>
        </td>
    </tr>
    <tr>
        <td colSpan=1>
            <div id="chart_div" style="align: center; width: 100%; height: 50%;"></div>
        </td>
    </tr>
</table>
</body>
</html>
